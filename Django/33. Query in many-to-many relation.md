# Get categories in an article 
Open shell and write these commands:
```Terminal
>>> from blog.models import *
>>> arts = Article.articles.all()
>>> for art in arts:
...     print(art.id)
... 
7
12
10
8
9
11
>>> a1 = Article.articles.get(id=10)
>>> a1
<Article: js 1>
>>> a1.categories
<django.db.models.fields.related_descriptors.create_forward_many_to_many_manager.<locals>.ManyRelatedManager object at 0x0000014A9FC31290>
>>> a1.categories.all()
<QuerySet [<Category: Python>, <Category: Django>, <Category: JS>]>
>>> cats = a1.categories.all()
>>> for cat in cats:
...     print(cat)
... 
Python
Django
JS
```

# Get articles in a category
```Terminal
>>> from blog.models import *
>>> c1 = Category.objects.get(id=1)
>>> c1
<Category: Python>
>>> c1.article_set.all()
<QuerySet [<Article: art1>, <Article: js 1>, <Article: art2>, <Article: new art>, <Article: js 2>]>
```

# Create new category
```Terminal
>>> from blog.models import *
>>> new_cat = Category.objects.create(title='C++')
>>> new_cat.save()
```

# Create a category and then add it to an existing article
```Terminal
from blog.models import *
>>> a1 = Article.articles.get(id=10)
>>> c1 = Category.objects.get(id=1)
>>> new_cat = Category.objects.create(title='C')
>>> a1.categories.add(new_cat)
```

# Complex queries 
[Many-to-many relationships | Django documentation | Django](https://docs.djangoproject.com/en/5.2/topics/db/examples/many_to_many/)

Many-to-many relationships can be queried using [lookups across relationships](https://docs.djangoproject.com/en/5.2/topics/db/queries/#lookups-that-span-relationships):
```Terminal
>>> Article.objects.filter(publications__id=1)
<QuerySet [<Article: Django lets you build web apps easily>, <Article: NASA uses Python>]>
>>> Article.objects.filter(publications__pk=1)
<QuerySet [<Article: Django lets you build web apps easily>, <Article: NASA uses Python>]>
>>> Article.objects.filter(publications=1)
<QuerySet [<Article: Django lets you build web apps easily>, <Article: NASA uses Python>]>
>>> Article.objects.filter(publications=p1)
<QuerySet [<Article: Django lets you build web apps easily>, <Article: NASA uses Python>]>

>>> Article.objects.filter(publications__title__startswith="Science")
<QuerySet [<Article: NASA uses Python>, <Article: NASA uses Python>]>

>>> Article.objects.filter(publications__title__startswith="Science").distinct()
<QuerySet [<Article: NASA uses Python>]>
```

The [`count()`](https://docs.djangoproject.com/en/5.2/ref/models/querysets/#django.db.models.query.QuerySet.count "django.db.models.query.QuerySet.count") function respects [`distinct()`](https://docs.djangoproject.com/en/5.2/ref/models/querysets/#django.db.models.query.QuerySet.distinct "django.db.models.query.QuerySet.distinct") as well:
```Terminal
>>> Article.objects.filter(publications__title__startswith="Science").count()
2
>>> Article.objects.filter(publications__title__startswith="Science").distinct().count()
1

>>> Article.objects.filter(publications__in=[1, 2]).distinct()
<QuerySet [<Article: Django lets you build web apps easily>, <Article: NASA uses Python>]>
>>> Article.objects.filter(publications__in=[p1, p2]).distinct()
<QuerySet [<Article: Django lets you build web apps easily>, <Article: NASA uses Python>]>
```

Reverse m2m queries are supported (i.e., starting at the table that doesn’t have a [`ManyToManyField`](https://docs.djangoproject.com/en/5.2/ref/models/fields/#django.db.models.ManyToManyField "django.db.models.ManyToManyField")):
```Terminal
>>> Publication.objects.filter(id=1)
<QuerySet [<Publication: The Python Journal>]>
>>> Publication.objects.filter(pk=1)
<QuerySet [<Publication: The Python Journal>]>

>>> Publication.objects.filter(article__headline__startswith="NASA")
<QuerySet [<Publication: Highlights for Children>, <Publication: Science News>, <Publication: Science Weekly>, <Publication: The Python Journal>]>

>>> Publication.objects.filter(article__id=1)
<QuerySet [<Publication: The Python Journal>]>
>>> Publication.objects.filter(article__pk=1)
<QuerySet [<Publication: The Python Journal>]>
>>> Publication.objects.filter(article=1)
<QuerySet [<Publication: The Python Journal>]>
>>> Publication.objects.filter(article=a1)
<QuerySet [<Publication: The Python Journal>]>

>>> Publication.objects.filter(article__in=[1, 2]).distinct()
<QuerySet [<Publication: Highlights for Children>, <Publication: Science News>, <Publication: Science Weekly>, <Publication: The Python Journal>]>
>>> Publication.objects.filter(article__in=[a1, a2]).distinct()
<QuerySet [<Publication: Highlights for Children>, <Publication: Science News>, <Publication: Science Weekly>, <Publication: The Python Journal>]>
```

Excluding a related item works as you would expect, too (although the SQL involved is a little complex):
```Terminal
>>> Article.objects.exclude(publications=p2)
<QuerySet [<Article: Django lets you build web apps easily>]>
```

If we delete an `Article`, its related `Publication` instances won’t be able to access it:
```Terminal
>>> a2.delete()
>>> Article.objects.all()
<QuerySet [<Article: Django lets you build web apps easily>]>
>>> p2.article_set.all()
<QuerySet []>
```

And from the other end:
```
>>> p2.article_set.remove(a5)
>>> p2.article_set.all()
<QuerySet []>
>>> a5.publications.all()
<QuerySet []>
```
